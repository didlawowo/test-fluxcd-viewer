apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: traefik
  namespace: traefik
spec:
  interval: 5m
  chart:
    spec:
      chart: traefik
      version: "34.2.0" # ğŸ”„ Version actuelle de Traefik
      sourceRef:
        kind: HelmRepository
        name: traefik # ğŸ”„ Changed from bitnami to traefik
        namespace: flux-system
  values:
    # ğŸŒ Service configuration
    service:
      enabled: true
      type: LoadBalancer # âš ï¸ Changed to LoadBalancer for external access

    # ğŸ”’ Default ports configuration
    ports:
      web:
        port: 80
      websecure:
        port: 443

    # ğŸ® Dashboard configuration
    dashboard:
      enabled: true

    # ğŸ’ª Resource limits
    resources:
      limits:
        memory: 256Mi # âš ï¸ Increased for better performance
        cpu: 200m
      requests:
        memory: 128Mi # âš ï¸ Increased for stability
        cpu: 100m

    # ğŸ” Security settings
    globalArguments:
    - "--global.checknewversion=false"
    - "--global.sendanonymoususage=false"
    # ğŸ·ï¸ Additional labels
    deployment:
      labels:
        app.kubernetes.io/name: traefik
        app.kubernetes.io/instance: traefik
